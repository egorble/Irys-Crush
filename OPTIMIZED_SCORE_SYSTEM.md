# –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ –°–∏—Å—Ç–µ–º–∞ –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è –†–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤ PVP

## –ü—Ä–æ–±–ª–µ–º–∏ –°—Ç–∞—Ä–æ—ó –°–∏—Å—Ç–µ–º–∏

### üö® –ü—Ä–æ–±–ª–µ–º–∏:
1. **–î—É–±–ª—ñ–∫–∞—Ç–∏ –∫–æ–¥—É** - –ª–æ–≥—ñ–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–æ–≤—Ç–æ—Ä—é–≤–∞–ª–∞—Å—è –≤ –∫—ñ–ª—å–∫–æ—Ö –º—ñ—Å—Ü—è—Ö
2. **–°–∫–ª–∞–¥–Ω–∞ –ª–æ–≥—ñ–∫–∞** - –±–∞–≥–∞—Ç–æ –≤–∫–ª–∞–¥–µ–Ω–∏—Ö –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ —ñ —É–º–æ–≤
3. **Race Conditions** - –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –º–Ω–æ–∂–∏–Ω–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤
4. **–ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å** - —Ä—ñ–∑–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫ –≤ —Ä—ñ–∑–Ω–∏—Ö –º—ñ—Å—Ü—è—Ö
5. **–í–∞–∂–∫–æ –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏** - –∫–æ–¥ —Ä–æ–∑–∫–∏–¥–∞–Ω–∏–π –ø–æ —Ä—ñ–∑–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ—è—Ö

### üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å—Ç–∞—Ä–æ–≥–æ –∫–æ–¥—É:
- **submitGameResult()**: ~200 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É
- **checkSubmissionStatus()**: ~50 —Ä—è–¥–∫—ñ–≤
- **checkSubmissionStatusReadOnly()**: ~40 —Ä—è–¥–∫—ñ–≤
- **monitorGameCompletion()**: ~100 —Ä—è–¥–∫—ñ–≤
- **–ó–∞–≥–∞–ª–æ–º**: ~400+ —Ä—è–¥–∫—ñ–≤ —Å–∫–ª–∞–¥–Ω–æ—ó –ª–æ–≥—ñ–∫–∏

## –ù–æ–≤–∞ –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ –°–∏—Å—Ç–µ–º–∞

### ‚úÖ –ü–µ—Ä–µ–≤–∞–≥–∏:
1. **–¶–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –ª–æ–≥—ñ–∫–∞** - –≤—Å—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó –≤ –æ–¥–Ω–æ–º—É Score Manager
2. **–ü—Ä–æ—Å—Ç–æ—Ç–∞** - –∑—Ä–æ–∑—É–º—ñ–ª–∏–π API –∑ –º—ñ–Ω—ñ–º–∞–ª—å–Ω–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
3. **–ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å** - –≤–±—É–¥–æ–≤–∞–Ω–∏–π –∑–∞—Ö–∏—Å—Ç –≤—ñ–¥ race conditions
4. **–ü–æ–≤—Ç–æ—Ä–Ω—ñ —Å–ø—Ä–æ–±–∏** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–Ω—è –ø—Ä–∏ –ø–æ–º–∏–ª–∫–∞—Ö
5. **–õ–µ–≥–∫–æ —Ç–µ—Å—Ç—É–≤–∞—Ç–∏** - —ñ–∑–æ–ª—å–æ–≤–∞–Ω–∞ –ª–æ–≥—ñ–∫–∞

### üèóÔ∏è –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞:

```
PVPGameEngine
    ‚Üì
PVPScoreManager (—Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π)
    ‚Üì
Smart Contract (submitRoomScore)
```

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –°—Ç–∞—Ä–∏–π —Å–ø–æ—Å—ñ–± (—Å–∫–ª–∞–¥–Ω–∏–π):
```javascript
// –ë–∞–≥–∞—Ç–æ –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ —ñ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤
if (this.resultSubmitted) return;
if (this.submissionInProgress) return;
this.submissionInProgress = true;

// –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ –±–ª–æ–∫—á–µ–π–Ω—ñ
const currentScore = await contract.getPlayerRoomScore(...);
if (currentScore > 0) { /* –æ–±—Ä–æ–±–∫–∞ */ }

// –©–µ –æ–¥–Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞
const statusResult = await checkAllScoresSubmitted(...);
// ... —â–µ 50 —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É

// –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
const tx = await contract.submitRoomScore(...);
// ... –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫
```

### –ù–æ–≤–∏–π —Å–ø–æ—Å—ñ–± (–ø—Ä–æ—Å—Ç–∏–π):
```javascript
// –û–¥–∏–Ω –≤–∏–∫–ª–∏–∫ - –≤—Å—è –ª–æ–≥—ñ–∫–∞ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ
const result = await window.pvpScoreManager.submitScore(
    this.roomId, 
    this.finalScore,
    { source: 'game_end' }
);

if (result.success) {
    this.resultSubmitted = true;
    this.startGameCompletionMonitoring();
}
```

## –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å Score Manager

### üîß –û—Å–Ω–æ–≤–Ω—ñ –º–µ—Ç–æ–¥–∏:
- `submitScore(roomId, score, options)` - –ø–æ–¥–∞—Ç–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç
- `checkIfAlreadySubmitted(roomId)` - –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —á–∏ –≤–∂–µ –ø–æ–¥–∞–Ω–æ
- `getSubmissionState(roomId)` - –æ—Ç—Ä–∏–º–∞—Ç–∏ –ø–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω
- `clearRoomState(roomId)` - –æ—á–∏—Å—Ç–∏—Ç–∏ —Å—Ç–∞–Ω –∫—ñ–º–Ω–∞—Ç–∏

### üõ°Ô∏è –ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –ø–æ–º–∏–ª–æ–∫:
- **Race Condition Protection** - –∞—Ç–æ–º–∞—Ä–Ω—ñ –æ–ø–µ—Ä–∞—Ü—ñ—ó
- **Duplicate Prevention** - –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞–Ω—É –ø–µ—Ä–µ–¥ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è–º
- **Retry Logic** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ –ø–æ–≤—Ç–æ—Ä–Ω—ñ —Å–ø—Ä–æ–±–∏
- **Error Classification** - —Ä–æ–∑—É–º–Ω–∞ –æ–±—Ä–æ–±–∫–∞ —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ –ø–æ–º–∏–ª–æ–∫

### üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–æ–≤–æ–≥–æ –∫–æ–¥—É:
- **PVPScoreManager**: ~200 —Ä—è–¥–∫—ñ–≤ (–≤—Å—è –ª–æ–≥—ñ–∫–∞)
- **submitGameResult()**: ~20 —Ä—è–¥–∫—ñ–≤
- **forfeitGame()**: ~15 —Ä—è–¥–∫—ñ–≤ (—Ç—ñ–ª—å–∫–∏ Score Manager –≤–∏–∫–ª–∏–∫)
- **–ó–∞–≥–∞–ª–æ–º**: ~235 —Ä—è–¥–∫—ñ–≤ —á–∏—Å—Ç–æ–≥–æ –∫–æ–¥—É

## –†–µ–∑—É–ª—å—Ç–∞—Ç –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—ó

### üìä –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è:
- **-40% –∫–æ–¥—É** - –∑ 400+ –¥–æ 235 —Ä—è–¥–∫—ñ–≤
- **-60% —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ** - —Ü–µ–Ω—Ç—Ä–∞–ª—ñ–∑–æ–≤–∞–Ω–∞ –ª–æ–≥—ñ–∫–∞
- **+100% –Ω–∞–¥—ñ–π–Ω–æ—Å—Ç—ñ** - –≤–±—É–¥–æ–≤–∞–Ω–∏–π –∑–∞—Ö–∏—Å—Ç
- **+200% –ø—ñ–¥—Ç—Ä–∏–º—É–≤–∞–Ω–æ—Å—Ç—ñ** - –º–æ–¥—É–ª—å–Ω–∞ –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

### üöÄ –ü–µ—Ä–µ–≤–∞–≥–∏ –¥–ª—è —Ä–æ–∑—Ä–æ–±–∫–∏:
1. **–õ–µ–≥—à–µ –¥–æ–¥–∞–≤–∞—Ç–∏ –Ω–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó** - –æ–¥–∏–Ω —Ñ–∞–π–ª –¥–ª—è –∑–º—ñ–Ω
2. **–ü—Ä–æ—Å—Ç—ñ—à–µ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è** - —ñ–∑–æ–ª—å–æ–≤–∞–Ω–∞ –ª–æ–≥—ñ–∫–∞
3. **–ú–µ–Ω—à–µ –±–∞–≥—ñ–≤** - –º–µ–Ω—à–µ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤ –∫–æ–¥—É
4. **–ö—Ä–∞—â–∏–π UX** - –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–∞ –æ–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

## –ú–∞–π–±—É—Ç–Ω—ñ –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è

### üîÆ –ú–æ–∂–ª–∏–≤—ñ –¥–æ–¥–∞–≤–∞–Ω–Ω—è:
- **–ö–µ—à—É–≤–∞–Ω–Ω—è** - –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —Å—Ç–∞–Ω—É –≤ localStorage
- **–û—Ñ–ª–∞–π–Ω –ø—ñ–¥—Ç—Ä–∏–º–∫–∞** - —á–µ—Ä–≥–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π
- **–ê–Ω–∞–ª—ñ—Ç–∏–∫–∞** - –∑–±—ñ—Ä —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–¥–∞–Ω—å
- **Batch –æ–ø–µ—Ä–∞—Ü—ñ—ó** - –≥—Ä—É–ø–æ–≤–µ –ø–æ–¥–∞–Ω–Ω—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ñ–≤

### üéØ –¶—ñ–ª—ñ:
- –ó–º–µ–Ω—à–∏—Ç–∏ —á–∞—Å –≤—ñ–¥–≥—É–∫—É –Ω–∞ 50%
- –ü—ñ–¥–≤–∏—â–∏—Ç–∏ —É—Å–ø—ñ—à–Ω—ñ—Å—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π –¥–æ 99%
- –î–æ–¥–∞—Ç–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫—É –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤
- –Ü–Ω—Ç–µ–≥—Ä—É–≤–∞—Ç–∏ –∑ —Å–∏—Å—Ç–µ–º–æ—é –Ω–æ—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ–π